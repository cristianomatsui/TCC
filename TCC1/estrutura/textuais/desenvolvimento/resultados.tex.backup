% RESULTADOS-------------------------------------------------------------------

\chapter{RESULTADOS}
\label{chap:resultados}

Este capítulo ilustra como foram feitas as etapas de implementação, detalhando alguns fatores importantes nos códigos utilizados, métodos para a descoberta ótima do número de focos para cada base,
assim como uma breve explicação sobre as bases de dados utilizadas e algunas das métricas empregadas. Também apresenta os resultados
obtidos, e análises pertinentes a estes resultados, estabelecendo um comparativo com as técnicas convencionais de pesquisa por similaridade.

\section{BASES DE DADOS}
\label{sec:basesdedados}
Foram utilizadas duas bases de dados complexas distintas para a verificação deste trabalho: uma base de imagens de cães e gatos, e uma
base de dados extraídos de exames médicos de imagem.

\catcode`\_=13 
\def_{\textunderscore}
\subsection{BASE CAT_DOG}
\catcode`_=8
\label{subsec:catdog}
Esta base de dados é dividida entre conjunto de teste e conjunto de treinamento, e encontra-se disponível em \href{https://www.kaggle.com/c/dogs-vs-cats}{<https://www.kaggle.com/c/dogs-vs-cats>}.
A base originalmente foi criada para uma competição promovida pela comunidade de cientistas de dados conhecida como Kaggle, aonde o objetivo era criar o algoritmo que conseguisse classificar imagens
entre fotografias ou desenhos de gatos ou cachorros com o maior índice de acerto. 

Para a verificação das técnicas implementadas, foi utilizado o conjunto de imagens de treino, com 25000 imagens, divididas igualmente entre cães e gatos. 
Tornou-se necessário a remoção de 3 imagens que eram pequenas demais e impossibilitavam a segmentação destas na etapa de processamento de imagens, que será melhor explanada na subseção \ref{subsec:procim}. As imagens foram processadas para a extração
das características desejadas e inseridas no banco de dados.

\begin{figure}[H]
  \centering
  \subfloat[cat.325]{\includegraphics[width=.20\textwidth]{dados/figuras/cat325.jpg}} \hspace{2cm}
  \subfloat[cat.6243]{\includegraphics[width=.20\textwidth]{dados/figuras/cat6243.jpg}} \\
  \subfloat[dog.2032]{\includegraphics[width=.20\textwidth]{dados/figuras/dog2032.jpg}}\hspace{2cm}
  \subfloat[dog.10641]{\includegraphics[width=.20\textwidth]{dados/figuras/dog10641.jpg}} 
  \caption{Exemplos de imagens da base CAT\_DOG}
\label{fig:catdogex}
\end{figure}

\subsection{BASE HC}
%TODO PEGAR MAIS INFORMAÇÕES SOBRE ESSA BASE
A base HC foi fornecida pelo Hospital das Clínicas de ALGUMLUGAR, e ela consiste em 500000 imagens com as suas características já extraídas. Embora ela seja uma base não-sintética, não foram fornecidos as imagens correspondentes aos vetores de características,
tornando-se assim impossível realizar uma análise qualitativa sobre a taxa de acerto nas buscas por similaridade mas ainda é possível verificar o tempo de consulta nesta base, fator este que é o interesse deste trabalho.

Os dados se encontram na forma de vetores, com a primeira posição sendo um número inteiro utilizado como um identificador da coluna seguido por um vetor de 256 números decimais, representando as características extraídas de cada imagem. Embora esta base não
possua as imagens correspondentes aos dados extraídos, o seu tamanho e a sua complexidade são maiores do que a base apresentada em \ref{subsec:catdog}, tornando mais evidente os ganhos de performance nas consultas por similaridade utilizando as técnicas propostas.


\section{MÉTRICAS DOS TESTES} %TODO Materiais?
\label{sec:metricas}
As métricas utilizadas nos testes foram os tempos gastos pelo pgAdmin para planejar e executar as consultas. Estas métricas foram adquiridas através dos comandos \textit{EXPLAIN ANALYZE} seguido da consulta a ser realizada, como por exemplo: \textit{EXPLAIN ANALYZE
SELECT * FROM rangeOmniHCF2(12345, 30)}.

Os testes foram feitos escolhendo um centro de pesquisa aleatoriamente, e variando os parâmetros de raio para o caso da consulta por abrangência, e
os valores de $k$ para uma consulta do tipo $k$-vizinhos mais próximos. Também foi utilizado o número de podas de cálculos desnecessários de distância, conseguidos pela técnica aplicada neste trabalho.

\subsection{EXPLAIN ANALYZE}
O comando \textit{EXPLAIN ANALYZE} utilizado para a verificação dos tempos gastos pelo SGBD para a realização das consultas é nativo exclusivamente do PostgreSQL. O comando é utilizado para
mostrar o plano de execução gerado para uma declaração, sem executá-la. As tabelas referenciadas, assim como algoritmos de junção ou índices utilizados são
explicitados pelo \textit{EXPLAIN} \cite{POSTGRESQL2017}. Em associação com o comando \textit{ANALYZE}, a declaração também é executada e as estatísticas relacionadas ao tempo de execução atuais são mostradas para o usuário, divididas entre templo de planejamento e tempo de execução.


\subsubsection{TEMPO DE PLANEJAMENTO}
O tempo de planejamento (\textit{planning time}) é o tempo gasto pelo SGBD para planejar a maneira mais rápida de executar a consulta. O plano escolhido
é aquele que possui a execução estimada menos custosa dentre diversos outros planos testados pelo planejador. No contexto deste trabalho, o tempo de planejamento 
é pequeno o bastante para ser desprezado, representando um pouco mais de 1\% do tempo gasto no caso da consulta mais rápida, e menos de 0,001\% no caso mais lento.

\subsubsection{TEMPO DE EXECUÇÃO}
O tempo de execução (\textit{execution time}) representa o tempo em que o sistema leva para para executar o plano de consulta escolhido, além do tempo gasto para retornar 
a resposta da consulta para o usuário. Para o mérito de análise do ganho de performance utilizando a técnica OMNI, esta será a métrica utilizada. Este tempo é influenciado pela
complexidade da consulta, tamanho da base de dados, presença ou não de índices e hardware utilizado para a sua execução. Os tempos de planejamento ficaram em uma média de 0.023 ms para
pesquisas na base cat\_dog e XXXXXX ms para pesquisas na base HC.

\section{NÚMERO DE FOCOS}
Como mencionado no capítulo \ref{chap:omni}, a escolha do número de focos impacta diretamente na performance da técnica OMNI. Se o número for menor que o ótimo, a \textit{mbOr} torna-se
muito grande, e o número de podas de cálculos diminui, aumentando assim o tempo de execução. Se o número de focos for maior que o ótimo, existe pouca variação na \textit{mbOr} mas o número de cálculos necessários para
descobrir a pertinência na região aumenta, aumentando o tempo de execução. O cálculo da dimensão intrínseca da base de dados pela técnica de box-counting não é realizável para bases
clusterizadas \cite{Mo2012} e normalizar as coordenadas de uma base de dados deste tipo seria alterar as informações originais salvas nas tabelas, alterando assim o dado armazenado. Uma solução
proposta por este trabalho provém da contagem do número de podas.

O número ótimo de focos é obtido analisando um gráfico do número de podas em relação ao número de focos utilizados. Este número é o menor inteiro mais próximo da região do gráfico onde há menor variação do número de podas.
Como ilustrado pelas figuras \ref{fig:focoHC} e \ref{fig:fococatdog}, os números ótimos de focos para as bases HC e cat\_dog são respectivamente 2 e 1.


\begin{figure}[H]
\centering
\caption{Número de podas por focos utilizados para a base HC}
\includegraphics[width=.6\textwidth]{dados/figuras/focoHC.eps}
\fonte{Autoria Própria}
\label{fig:focoHC}
\end{figure}

\begin{figure}[H]
\centering
\caption{Número de podas por focos utilizados para a base cat\_dog}
\includegraphics[width=.6\textwidth]{dados/figuras/fococatdog.eps}
\fonte{Autoria Própria}
\label{fig:fococatdog}
\end{figure}

\section{SCRIPTS SQL}
Os scripts necessários para a parte de manipulação do banco de dados foram todos escritos em PLPGSQL, uma linguagem 